{"ast":null,"code":"import _objectSpread from \"E:\\\\TRISTAN\\\\Repos\\\\ReactReferenceData\\\\FluxTest\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread\";\nimport _slicedToArray from \"E:\\\\TRISTAN\\\\Repos\\\\ReactReferenceData\\\\FluxTest\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"E:\\\\TRISTAN\\\\Repos\\\\ReactReferenceData\\\\FluxTest\\\\src\\\\components\\\\AsyncTree.js\";\nimport React, { useEffect, useState } from \"react\";\nimport { Tree, Menu, Dropdown, Spin, Layout, Input } from \"antd\";\nimport PropTypes from \"prop-types\";\nimport \"antd/dist/antd.css\"; //import { GetTreeData, GetTreeChildren } from \"./MockData\";\n\nimport { UserOutlined, HomeOutlined } from \"@ant-design/icons\"; //fixed calls\n\nconst rootURLCall = \"https://localhost:5001/api/trees\";\nconst childURLCall = \"https://localhost:5001/api/trees/\";\nconst searchURLCall = \"https://localhost:5001/api/tree/\"; //constants\n\nconst Search = Input.Search; //fixed layouts\n\nconst layout = {\n  labelCol: {\n    span: 8\n  },\n  wrapperCol: {\n    span: 16\n  }\n}; //fixed pre load data\n\nconst baseTree = [{\n  title: \"Branch1\",\n  key: \"1\",\n  isLeaf: false\n}];\nexport function BranchTree(props) {\n  //hooks\n  const _useState = useState(baseTree),\n        _useState2 = _slicedToArray(_useState, 2),\n        treeData = _useState2[0],\n        setTreeData = _useState2[1];\n\n  const _useState3 = useState([]),\n        _useState4 = _slicedToArray(_useState3, 2),\n        RCData = _useState4[0],\n        setRCData = _useState4[1];\n\n  const _useState5 = useState(true),\n        _useState6 = _slicedToArray(_useState5, 2),\n        isLoading = _useState6[0],\n        setisLoading = _useState6[1]; //update with new children\n\n\n  function updateTreeData(list, key, children) {\n    return list.map(node => {\n      if (node.key === key) {\n        return _objectSpread({}, node, {\n          children\n        });\n      }\n\n      if (node.children) {\n        return _objectSpread({}, node, {\n          children: updateTreeData(node.children, key, children)\n        });\n      }\n\n      return node;\n    });\n  } //call to get root object\n\n\n  function GetRoot() {\n    let obj = [];\n    fetch(rootURLCall, {\n      method: \"GET\",\n      headers: new Headers({\n        Accept: \"application/vnd.github.cloak-preview\"\n      })\n    }).then(res => res.json()).then(response => {\n      response.map(Main => {\n        obj.push({\n          title: Main.data[0].value,\n          key: Main.data[1].value,\n          icon: Main.data[2].value === \"0\" ? React.createElement(HomeOutlined, {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 67\n            },\n            __self: this\n          }) : React.createElement(UserOutlined, {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 67\n            },\n            __self: this\n          }),\n          isLeaf: Main.data[2].value === \"0\" ? false : true\n        });\n      });\n      setTreeData(obj);\n    }).catch(error => {\n      console.log(error);\n      return obj;\n    });\n    setisLoading(false);\n  } //async call to get children objects\n\n\n  async function GetChildNodes(ParentKey) {\n    const url = \"\".concat(childURLCall).concat(ParentKey);\n    let obj = [];\n    const response = await fetch(url, {\n      method: \"GET\"\n    });\n    const json = await response.json();\n    json.map(Main => {\n      obj.push({\n        title: Main.data[2].value,\n        key: Main.data[1].value,\n        icon: Main.data[3].value === \"0\" ? React.createElement(HomeOutlined, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 92\n          },\n          __self: this\n        }) : React.createElement(UserOutlined, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 92\n          },\n          __self: this\n        }),\n        isLeaf: Main.data[3].value === \"0\" ? false : true\n      });\n    });\n    return obj;\n  } //async function to find new children\n\n\n  async function onLoadData({\n    key,\n    children\n  }) {\n    const childNodes = await GetChildNodes(key);\n    return new Promise(resolve => {\n      if (children) {\n        resolve();\n        return;\n      }\n\n      setTreeData(origin => updateTreeData(origin, key, childNodes));\n      resolve();\n    });\n  } //async function to search the tree\n\n\n  async function treeSearch(e) {\n    setTreeData(baseTree);\n\n    if (e != \"\") {\n      const url = \"\".concat(searchURLCall).concat(e);\n      let obj = [];\n      const response = await fetch(url, {\n        method: \"GET\"\n      });\n      const json = await response.json();\n      json.map(Main => {\n        obj.push({\n          title: Main.data[2].value,\n          key: Main.data[1].value,\n          icon: Main.data[3].value === \"0\" ? React.createElement(HomeOutlined, {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 127\n            },\n            __self: this\n          }) : React.createElement(UserOutlined, {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 127\n            },\n            __self: this\n          }),\n          isLeaf: Main.data[3].value === \"0\" ? false : true\n        });\n      });\n      setTreeData(obj);\n    } else {} //search and then update the hook for the rootbranch\n    //disable loading icon\n\n  } //reset tree data each time rootBranch gets updated\n\n\n  useEffect(() => {\n    setTreeData(GetRoot());\n  }, [props.rootBranch]); //Right click menu\n\n  const menu = React.createElement(Menu, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 145\n    },\n    __self: this\n  }, !RCData.isLeaf ? React.createElement(Menu.Item, {\n    key: \"1\",\n    onClick: () => props.onRightClick(\"Branch\", RCData.key),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148\n    },\n    __self: this\n  }, \"Add new Branch\") : \"\", !RCData.isLeaf ? React.createElement(Menu.Item, {\n    key: \"2\",\n    onClick: () => props.onRightClick(\"Employee\", RCData.key),\n    value: \"Employee\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158\n    },\n    __self: this\n  }, \"Add new Employee\") : \"\"); //on right click, open a dropdown at that location\n\n  const onRC = event => {\n    setRCData(event.node);\n    console.log(event);\n  };\n\n  const onDragEnter = info => {\n    console.log(info);\n  }; //on drop, make a popup ask if they are sure they want to move X to Y\n\n\n  const onDrop = info => {\n    if (!window.confirm(\"Are you sure you wish to move \".concat(info.dragNode.title, \" into \").concat(info.node.title))) return;\n    console.log(info);\n    console.log(\"DragNode: \".concat(info.dragNode.title, \"   Node: \").concat(info.node.title));\n    const dropKey = info.node.props.eventKey;\n    const dragKey = info.dragNode.props.eventKey;\n    const dropPos = info.node.props.pos.split(\"-\");\n    const dropPosition = info.dropPosition - Number(dropPos[dropPos.length - 1]);\n\n    const loop = (data, key, callback) => {\n      data.forEach((item, index, arr) => {\n        if (item.key === key) {\n          return callback(item, index, arr);\n        }\n\n        if (item.children) {\n          return loop(item.children, key, callback);\n        }\n      });\n    };\n\n    const data = [...treeData]; // Find dragObject\n\n    let dragObj;\n    loop(data, dragKey, (item, index, arr) => {\n      arr.splice(index, 1);\n      dragObj = item;\n    });\n\n    if (!info.dropToGap) {\n      // Drop on the content\n      loop(data, dropKey, item => {\n        item.children = item.children || []; // where to insert\n\n        item.children.push(dragObj);\n      });\n    } else if ((info.node.props.children || []).length > 0 && // Has children\n    info.node.props.expanded && // Is expanded\n    dropPosition === 1 // On the bottom gap\n    ) {\n        loop(data, dropKey, item => {\n          item.children = item.children || []; // where to insert\n\n          item.children.unshift(dragObj);\n        });\n      } else {\n      let ar;\n      let i;\n      loop(data, dropKey, (item, index, arr) => {\n        ar = arr;\n        i = index;\n      });\n\n      if (dropPosition === -1) {\n        ar.splice(i, 0, dragObj);\n      } else {\n        ar.splice(i + 1, 0, dragObj);\n      }\n    } //update actual system as well, if it works then set the tree data\n\n\n    setTreeData(data);\n  };\n\n  return React.createElement(Layout, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 250\n    },\n    __self: this\n  }, React.createElement(Spin, {\n    spinning: isLoading,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 251\n    },\n    __self: this\n  }, React.createElement(Search, {\n    placeholder: \"search...\",\n    enterButton: \"Search\",\n    size: \"medium\",\n    onSearch: treeSearch,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 252\n    },\n    __self: this\n  }), React.createElement(Dropdown, {\n    overlay: menu,\n    trigger: [\"contextMenu\"],\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 259\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 260\n    },\n    __self: this\n  }, React.createElement(Tree, Object.assign({}, layout, {\n    showIcon: true,\n    style: {\n      height: \"auto\",\n      minHeight: \"570px\"\n    },\n    loadData: onLoadData,\n    onSelect: props.onSelect,\n    treeData: treeData,\n    draggable: true,\n    onDragEnter: onDragEnter,\n    onDrop: onDrop,\n    onRightClick: onRC,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 261\n    },\n    __self: this\n  }))))));\n}\nBranchTree.propTypes = {\n  rootBranch: PropTypes.string.isRequired,\n  onSelect: PropTypes.func.isRequired,\n  onRightClick: PropTypes.func.isRequired,\n  isBranch: PropTypes.bool,\n  //leave for now\n  form: PropTypes.bool //leave for now\n\n};","map":{"version":3,"sources":["E:\\TRISTAN\\Repos\\ReactReferenceData\\FluxTest\\src\\components\\AsyncTree.js"],"names":["React","useEffect","useState","Tree","Menu","Dropdown","Spin","Layout","Input","PropTypes","UserOutlined","HomeOutlined","rootURLCall","childURLCall","searchURLCall","Search","layout","labelCol","span","wrapperCol","baseTree","title","key","isLeaf","BranchTree","props","treeData","setTreeData","RCData","setRCData","isLoading","setisLoading","updateTreeData","list","children","map","node","GetRoot","obj","fetch","method","headers","Headers","Accept","then","res","json","response","Main","push","data","value","icon","catch","error","console","log","GetChildNodes","ParentKey","url","onLoadData","childNodes","Promise","resolve","origin","treeSearch","e","rootBranch","menu","onRightClick","onRC","event","onDragEnter","info","onDrop","window","confirm","dragNode","dropKey","eventKey","dragKey","dropPos","pos","split","dropPosition","Number","length","loop","callback","forEach","item","index","arr","dragObj","splice","dropToGap","expanded","unshift","ar","i","height","minHeight","onSelect","propTypes","string","isRequired","func","isBranch","bool","form"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport { Tree, Menu, Dropdown, Spin, Layout, Input } from \"antd\";\r\nimport PropTypes from \"prop-types\";\r\nimport \"antd/dist/antd.css\";\r\n//import { GetTreeData, GetTreeChildren } from \"./MockData\";\r\nimport { UserOutlined, HomeOutlined } from \"@ant-design/icons\";\r\n\r\n//fixed calls\r\nconst rootURLCall = \"https://localhost:5001/api/trees\";\r\nconst childURLCall = \"https://localhost:5001/api/trees/\";\r\nconst searchURLCall = \"https://localhost:5001/api/tree/\";\r\n\r\n//constants\r\nconst Search = Input.Search;\r\n\r\n//fixed layouts\r\nconst layout = {\r\n  labelCol: {\r\n    span: 8,\r\n  },\r\n  wrapperCol: {\r\n    span: 16,\r\n  },\r\n};\r\n\r\n//fixed pre load data\r\nconst baseTree = [{ title: \"Branch1\", key: \"1\", isLeaf: false }];\r\n\r\nexport function BranchTree(props) {\r\n  //hooks\r\n  const [treeData, setTreeData] = useState(baseTree);\r\n  const [RCData, setRCData] = useState([]);\r\n  const [isLoading, setisLoading] = useState(true);\r\n\r\n  //update with new children\r\n  function updateTreeData(list, key, children) {\r\n    return list.map((node) => {\r\n      if (node.key === key) {\r\n        return { ...node, children };\r\n      }\r\n      if (node.children) {\r\n        return {\r\n          ...node,\r\n          children: updateTreeData(node.children, key, children),\r\n        };\r\n      }\r\n      return node;\r\n    });\r\n  }\r\n\r\n  //call to get root object\r\n  function GetRoot() {\r\n    let obj = [];\r\n    fetch(rootURLCall, {\r\n      method: \"GET\",\r\n      headers: new Headers({\r\n        Accept: \"application/vnd.github.cloak-preview\",\r\n      }),\r\n    })\r\n      .then((res) => res.json())\r\n      .then((response) => {\r\n        response.map((Main) => {\r\n          obj.push({\r\n            title: Main.data[0].value,\r\n            key: Main.data[1].value,\r\n            icon:\r\n              Main.data[2].value === \"0\" ? <HomeOutlined /> : <UserOutlined />,\r\n            isLeaf: Main.data[2].value === \"0\" ? false : true,\r\n          });\r\n        });\r\n        setTreeData(obj);\r\n      })\r\n      .catch((error) => {\r\n        console.log(error);\r\n        return obj;\r\n      });\r\n    setisLoading(false);\r\n  }\r\n\r\n  //async call to get children objects\r\n  async function GetChildNodes(ParentKey) {\r\n    const url = `${childURLCall}${ParentKey}`;\r\n    let obj = [];\r\n    const response = await fetch(url, {\r\n      method: \"GET\",\r\n    });\r\n    const json = await response.json();\r\n    json.map((Main) => {\r\n      obj.push({\r\n        title: Main.data[2].value,\r\n        key: Main.data[1].value,\r\n        icon: Main.data[3].value === \"0\" ? <HomeOutlined /> : <UserOutlined />,\r\n        isLeaf: Main.data[3].value === \"0\" ? false : true,\r\n      });\r\n    });\r\n    return obj;\r\n  }\r\n\r\n  //async function to find new children\r\n  async function onLoadData({ key, children }) {\r\n    const childNodes = await GetChildNodes(key);\r\n    return new Promise((resolve) => {\r\n      if (children) {\r\n        resolve();\r\n        return;\r\n      }\r\n      setTreeData((origin) => updateTreeData(origin, key, childNodes));\r\n      resolve();\r\n    });\r\n  }\r\n\r\n  //async function to search the tree\r\n  async function treeSearch(e) {\r\n    setTreeData(baseTree);\r\n    if (e != \"\") {\r\n      const url = `${searchURLCall}${e}`;\r\n      let obj = [];\r\n      const response = await fetch(url, {\r\n        method: \"GET\",\r\n      });\r\n      const json = await response.json();\r\n      json.map((Main) => {\r\n        obj.push({\r\n          title: Main.data[2].value,\r\n          key: Main.data[1].value,\r\n          icon:\r\n            Main.data[3].value === \"0\" ? <HomeOutlined /> : <UserOutlined />,\r\n          isLeaf: Main.data[3].value === \"0\" ? false : true,\r\n        });\r\n      });\r\n      setTreeData(obj);\r\n    } else {\r\n    }\r\n    //search and then update the hook for the rootbranch\r\n    //disable loading icon\r\n  }\r\n\r\n  //reset tree data each time rootBranch gets updated\r\n  useEffect(() => {\r\n    setTreeData(GetRoot());\r\n  }, [props.rootBranch]);\r\n\r\n  //Right click menu\r\n  const menu = (\r\n    <Menu>\r\n      {/* see if it is a branch, if it is, allow add new branch and add new employee */}\r\n      {!RCData.isLeaf ? (\r\n        <Menu.Item\r\n          key=\"1\"\r\n          onClick={() => props.onRightClick(\"Branch\", RCData.key)}\r\n        >\r\n          Add new Branch\r\n        </Menu.Item>\r\n      ) : (\r\n        \"\"\r\n      )}\r\n      {!RCData.isLeaf ? (\r\n        <Menu.Item\r\n          key=\"2\"\r\n          onClick={() => props.onRightClick(\"Employee\", RCData.key)}\r\n          value=\"Employee\"\r\n        >\r\n          Add new Employee\r\n        </Menu.Item>\r\n      ) : (\r\n        \"\"\r\n      )}\r\n    </Menu>\r\n  );\r\n\r\n  //on right click, open a dropdown at that location\r\n  const onRC = (event) => {\r\n    setRCData(event.node);\r\n    console.log(event);\r\n  };\r\n\r\n  const onDragEnter = (info) => {\r\n    console.log(info);\r\n  };\r\n  //on drop, make a popup ask if they are sure they want to move X to Y\r\n  const onDrop = (info) => {\r\n    if (\r\n      !window.confirm(\r\n        `Are you sure you wish to move ${info.dragNode.title} into ${info.node.title}`\r\n      )\r\n    )\r\n      return;\r\n    console.log(info);\r\n    console.log(`DragNode: ${info.dragNode.title}   Node: ${info.node.title}`);\r\n    const dropKey = info.node.props.eventKey;\r\n    const dragKey = info.dragNode.props.eventKey;\r\n    const dropPos = info.node.props.pos.split(\"-\");\r\n    const dropPosition =\r\n      info.dropPosition - Number(dropPos[dropPos.length - 1]);\r\n\r\n    const loop = (data, key, callback) => {\r\n      data.forEach((item, index, arr) => {\r\n        if (item.key === key) {\r\n          return callback(item, index, arr);\r\n        }\r\n        if (item.children) {\r\n          return loop(item.children, key, callback);\r\n        }\r\n      });\r\n    };\r\n    const data = [...treeData];\r\n\r\n    // Find dragObject\r\n    let dragObj;\r\n    loop(data, dragKey, (item, index, arr) => {\r\n      arr.splice(index, 1);\r\n      dragObj = item;\r\n    });\r\n\r\n    if (!info.dropToGap) {\r\n      // Drop on the content\r\n      loop(data, dropKey, (item) => {\r\n        item.children = item.children || [];\r\n        // where to insert\r\n        item.children.push(dragObj);\r\n      });\r\n    } else if (\r\n      (info.node.props.children || []).length > 0 && // Has children\r\n      info.node.props.expanded && // Is expanded\r\n      dropPosition === 1 // On the bottom gap\r\n    ) {\r\n      loop(data, dropKey, (item) => {\r\n        item.children = item.children || [];\r\n        // where to insert\r\n        item.children.unshift(dragObj);\r\n      });\r\n    } else {\r\n      let ar;\r\n      let i;\r\n      loop(data, dropKey, (item, index, arr) => {\r\n        ar = arr;\r\n        i = index;\r\n      });\r\n      if (dropPosition === -1) {\r\n        ar.splice(i, 0, dragObj);\r\n      } else {\r\n        ar.splice(i + 1, 0, dragObj);\r\n      }\r\n    }\r\n    //update actual system as well, if it works then set the tree data\r\n    setTreeData(data);\r\n  };\r\n\r\n  return (\r\n    <Layout>\r\n      <Spin spinning={isLoading}>\r\n        <Search\r\n          placeholder=\"search...\"\r\n          enterButton=\"Search\"\r\n          size=\"medium\"\r\n          onSearch={treeSearch}\r\n        />\r\n\r\n        <Dropdown overlay={menu} trigger={[\"contextMenu\"]}>\r\n          <div>\r\n            <Tree\r\n              {...layout}\r\n              showIcon={true}\r\n              style={{ height: \"auto\", minHeight: \"570px\" }}\r\n              loadData={onLoadData}\r\n              onSelect={props.onSelect}\r\n              treeData={treeData}\r\n              draggable\r\n              onDragEnter={onDragEnter}\r\n              onDrop={onDrop}\r\n              onRightClick={onRC}\r\n            />\r\n          </div>\r\n        </Dropdown>\r\n      </Spin>\r\n    </Layout>\r\n  );\r\n}\r\nBranchTree.propTypes = {\r\n  rootBranch: PropTypes.string.isRequired,\r\n  onSelect: PropTypes.func.isRequired,\r\n  onRightClick: PropTypes.func.isRequired,\r\n  isBranch: PropTypes.bool, //leave for now\r\n  form: PropTypes.bool, //leave for now\r\n};\r\n"]},"metadata":{},"sourceType":"module"}